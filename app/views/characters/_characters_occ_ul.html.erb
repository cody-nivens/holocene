  <table class='table'>
    <thead>
      <tr>
        <th>&nbsp;</th>
        <th>Name</th>
        <th>Group</th>
        <th>Hair Color</th>
        <th>Eye Color</th>
        <th>Gender</th>
        <th>Ethnicity</th>
        <th>Age</th>
        <th>Scene</th></tr>
    </thead>
    <tbody>
<% characters.order(:occupation_class).pluck(:occupation_class).map { |x| x || '' }.uniq.sort.each do |occ_class| %>
  <tr><th colspan="9"><%= (occ_class == '' ? '<blank>' : occ_class) %></th></tr>
    <% characters.where(occupation_class: occ_class).order(:occupation_class, :last_name, :first_name).distinct.each do |character| %>
      <% if character.main? %>
        <tr class="table-primary">
      <% else %>
        <tr>
      <% end %>
      <td></td>
      <td width="15%">
        <%= link_to character.full_name, polymorphic_path([object, character]) %>
      </td><td>
        <%= (!character.grouping? ? '' : "#{character.grouping}").to_s %>
      </td>
      <%== physical_attributes(character) %>
      <td>
        <%= (!character.ethnicity? ? '' : "#{character.ethnicity}").to_s %>
      </td><td>
        <% if object.class.name == 'Scene' %>
          <%= object.date_string[0..3].to_i - character.birth_year.to_i %>
        <% end %>
      </td><td>
        <% if object.class.name == 'Scene' %>
          <% character_scene = CharacterScene.where(character_id: character.id, scene_id: object.id) %>
          <%= link_to (fa_icon 'plus'), edit_character_scene_path(character_scene[0]), title: 'Edit character role in scene' %>
          <% unless character_scene[0].summary.nil? %>
            </td>
            </tr>
            <% if character.main? %>
              <tr class="table-primary">
            <% else %>
              <tr>
            <% end %>
            <td></td>
            <td colspan="8">
              <%= character_scene[0].summary.to_plain_text %>
          <% end %>
        <% else %>
          <%= character.scenes.where(book: object.id).size %>
        <% end %>
      </td>
    </tr>
  <% end %>
<% end %>
  </tbody>
</table>
